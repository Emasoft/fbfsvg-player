# Implementation Report: Windows SVG Player Image Sequence Mode Support
Generated: 2026-01-22T22:58:20Z

## Task
Added image sequence mode support to the Windows SVG player, allowing playback of folders containing numbered SVG frame files.

## Changes Made

### 1. Added Includes (Lines 32-33)
```cpp
#include <algorithm>  // For std::sort
#include <regex>      // For frame number extraction
```

### 2. Added Helper Functions (Lines 330-422)

**isDirectory()** - Windows API-based directory detection using GetFileAttributesA()

**extractFrameNumber()** - Regex-based frame number extraction from filenames (e.g., "frame_0001.svg" -> 1)

**scanFolderForSVGSequence()** - Windows API-based directory scanning using FindFirstFileA/FindNextFileA with sorted output by frame number

### 3. Added Variables (Lines 1567-1569)
```cpp
bool isImageSequence = false;       // Playing from folder of individual SVG files
std::vector<std::string> sequenceFiles;         // List of SVG files for image sequence mode
std::vector<std::string> sequenceSvgContents;   // Pre-loaded SVG contents for image sequence mode
```

### 4. Added Command-line Directory Detection (Lines 1661-1693)
- Detects when inputPath is a directory
- Enables image sequence mode and sequential mode
- Pre-loads all SVG contents into memory
- Uses first file for window dimensions

### 5. Updated Animation Frame Calculation (Lines 3292-3315)
- Added image sequence frame calculation before SMIL animation loop
- Skips SMIL animation processing when in image sequence mode
- Uses sequential counter-based frame indexing

### 6. Updated CPU Rendering Path (Lines 3553-3612)
- Added image sequence direct rendering branch
- Parses and renders separate SVG files per frame
- Falls back to standard threaded rendering for FBF.SVG files

### 7. Updated Browser FrameFolder Handling

**FrameFolder Double-click** (Lines 3118-3180):
- Loads and plays image sequence on double-click
- Pre-loads all SVG frames into memory
- Resets animation state

**Load Button** (Lines 2904-3033):
- Added FrameFolder support to Load button
- Clears image sequence mode when loading single files

**PlayArrowEntry** (Lines 3260-3316):
- Added actual image sequence playback on play arrow click
- Previously just showed "not supported" message

## Key Implementation Details

1. **Windows API Compatibility**: Uses Windows-specific FindFirstFileA/FindNextFileA instead of POSIX dirent.h
2. **Path Handling**: Converts backslashes to forward slashes for consistency
3. **Frame Sorting**: Sorts by extracted frame numbers with alphabetical fallback
4. **Memory Pre-loading**: All SVG frames loaded into memory at once for fast playback
5. **Sequential Mode**: Image sequences automatically use sequential mode (ignoring SMIL timing)

## Files Modified
- `/Users/emanuelesabetta/Code/SKIA-BUILD-ARM64/src/svg_player_animated_windows.cpp`

## Test Plan
1. Test command-line folder input: `svg_player.exe path/to/frames/`
2. Test browser FrameFolder double-click loading
3. Test browser Load button with FrameFolder selected
4. Test browser PlayArrow click on FrameFolder
5. Test frame number extraction with various naming patterns
6. Test transition from image sequence to FBF.SVG file (and back)

## Notes
- Implementation matches macOS player behavior
- No GPU (Graphite) rendering path for image sequences yet - uses CPU rendering
- Frame rate limited by parse + render time per frame
